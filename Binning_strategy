def zero_aware_qcut(df, col, q=3, labels=None, new_col_suffix='_bin'):
    """
    Applies qcut binning to non-zero values, and keeps zero values in a separate bin.
    """
    if labels is None:
        labels = [f'bin_{i}' for i in range(q)]
    
    new_col = col + new_col_suffix
    nonzero_mask = df[col] != 0

    # Apply qcut to non-zero values
    df.loc[nonzero_mask, new_col] = pd.qcut(
        df.loc[nonzero_mask, col],
        q=q,
        labels=labels
    )

    # Label 0s separately
    df.loc[~nonzero_mask, new_col] = 'none'
    return df


cols_to_bin = ['connected_party_count', 'shared_address_count', 'shared_device_count']

for col in cols_to_bin:
    df = zero_aware_qcut(df, col, q=3, labels=['low', 'medium', 'high'])
