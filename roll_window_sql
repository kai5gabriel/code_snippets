WITH past_counts AS (
  SELECT 
    t1.id,
    t1.date,
    t1.value,
    SUM(CASE WHEN t2.date BETWEEN t1.date - INTERVAL '3 days' AND t1.date THEN 1 ELSE 0 END) AS count_past_3_days,
    SUM(CASE WHEN t2.date BETWEEN t1.date - INTERVAL '7 days' AND t1.date THEN 1 ELSE 0 END) AS count_past_7_days,
    SUM(CASE WHEN t2.date BETWEEN t1.date - INTERVAL '14 days' AND t1.date THEN 1 ELSE 0 END) AS count_past_14_days
  FROM 
    your_table t1
  LEFT JOIN 
    your_table t2 ON t1.id = t2.id AND t2.date <= t1.date
  GROUP BY 
    t1.id, t1.date, t1.value
)
SELECT 
  id,
  date,
  value,
  count_past_3_days,
  count_past_7_days,
  count_past_14_days
FROM 
  past_counts
ORDER BY 
  id, date;
